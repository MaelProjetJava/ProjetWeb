<!DOCTYPE html>
<html>
<head>
	<title>Projet Map</title>
	<meta charset="utf-8">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css"
   integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
   crossorigin=""/>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>

		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
		<script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"
   			integrity="sha512-QVftwZFqvtRNi0ZyCtsznlKSWOStnDORoefr1enyq5mVL4tmKB3S/EnC3rRJcxCPavG10IcrVGSmPh6Qw5lwrg=="
   			crossorigin=""></script>
   <link rel="stylesheet" href="web.css">

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>



<script src="db.js"></script>

<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
	<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />
<script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster-src.js"></script>



<script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/Leaflet.fullscreen.min.js'></script>
<link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/leaflet.fullscreen.css' rel='stylesheet' />

<script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
<script src="graphique.js"></script>
<script src="recherche.js"></script>

</head>
<body>

<div class="container">
	<div class="row-md-4" >
		<div class="card card-body">
			<div class="col" style="text-align:center">
				Alien Finder 
			</div>
		</div>
	
	</div>

	<div class="row" >
				
				<div class="col-md-2" >
					<
					<div class="card card-body ">
	
						<div class="lien"> lien 1 </div>

						<div class="lien"> lien 2</div>

						<div class="lien"> lien 3 </div>

						<div class="lien" > lien 4 </div>

					</div>
	
		
				</div>

				<div class="col-md-10" >
					<div class="card card-body">
						<div class="card card-body" id="onglet">
							<div class="row" >
							

								<div  class="col-md-4 onglet"> <span id="titre1" >MAP </span></div>

								<div class="col-md-4 onglet"> <span id="titre2" > STATS </span> </div>

								<div class="col-md-4 onglet" > <span id="titre3" > - - - - </span> </div>
								
							</div>
				

						</div>
						<div class="row" >
						<div  class="col-md-12">
						<form  id="recherche" role="form">
								<div class="card card-body">
										<div class="form-row">
								 			<div class="form-group col-md-2">
												   <select id="objetliste">
													  <option value="year">Année</option>
													  <option value="city">Ville</option>
													  <option value="comments">Commentaire</option>
													  <option value="shape">Forme</option>
													</select>
											</div>
											<div class="form-group col-md-8">
												
											        <input class="form-control"  type="search"  id="search">
											    
											</div>
											<div class="form-group col-md-2">
														<button type="submit" class="btn btn-primary"   >Rechercher</button>
											</div>
										</div>
								</div>
							
						</form>

						</div>
						</div>

						<div id=carte>

						<div class="row" >
							<div class="col-md-12" >
								<div id="mapid"> </div>
							</div>
						</div>

						<div class="row" >
							<div class="col-md-12" >
						
	
								 <form id="data" role="form">
								 	<div class="card card-body">
								 		<div class="form-row">
								 			<div class="form-group col-md-6">
												     <label for="date">Date d'apparition</label>
												    <input class="form-control" type="date" id="date" name="date">
											
											</div>
											<div class="form-group col-md-6">
												
											        <label for="time">Heure d'apparition</label>
											        <input class="form-control" type="time" id="time" name="time">
											    
											</div>
										</div>
										<div class="form-row">
								 			<div class="form-group col-md-6">
											   
											        <label for="area"> Lieu d'apparition</label>
											        <input  class="form-control" type="text" id="area" name="area">
											    
									    	</div>
										    <div class="form-group col-md-6">
											   
											        <label for="duration">Durée d'apparition</label>
											        <input  class="form-control" type="number" id="duration" name="duration" placeholder="En secondes">
											</div>
										</div>
										<div class="form-row">
											<div class="form-group col-md-6">
											   
											        <label for="shape">Forme</label>
											        <input  class="form-control" type="text" id="shape" name="shape">

											       <br/>
											    <div class="form-row">    
													<div class="form-group col-md-6">
														<button  id="modif" class="btn btn-primary"   >Modifier</button>
													</div>
													<div class="form-group col-md-6">
														<button type="submit" id  class="btn btn-primary"   >Annuler</button>
													</div>
												</div>
											    
											</div>
											<div class="form-group col-md-6">
											    
											        <label for="comments">Commentaire</label>
											        <textarea   class="form-control" id="comments" name="comments"  rows="5" cols="33"> </textarea>
											</div>
										
											    
										</div>

										
									</div>
								</form>
													
							</div>

						</div>
						</div>

						<div class="row" id="stat">
							<div class="col-md-12" >
								<div id="chartContainerLine" style="height: 370px;"></div>
							</div>
							<div class="col-md-12" >
								<div id="chartContainerColumn" style="height: 370px;  "></div>
							</div>
							<div class="col-md-12" >
								<div id="chartContainerPie" style="height: 370px; "></div>
							</div>
						</div>

					</div>
	
				</div>


		
	
	</div>





		
</div>
		

 <script >var mymap = L.map('mapid', {fullscreenControl: true}).setView([51.505, -0.09], 13);


var vue = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
});
vue.addTo(mymap);

// si on veut changer la vue de la map 
var googleHybrid = L.tileLayer('http://{s}.google.com/vt/lyrs=s,h&x={x}&y={y}&z={z}',{
    maxZoom: 20,
    subdomains:['mt0','mt1','mt2','mt3']
});
//googleHybrid.addTo(mymap);


mymap.on('dblclick', ajoutpoint);


var markers = new L.MarkerClusterGroup();

let ovni="";




$("#stat").hide();
$(document).ready(function(){

  $("#titre1").click(function(){

		$("#carte").show();
		$("#stat").hide();

	});
    $("#titre2").click(function(){


		$("#carte").hide();
		$("#stat").show();
		graph();

	});

        $("#titre3").click(function(){
        	window.location="404.html";


	});
        $(".lien").click(function(){
        	window.location="404.html";


	});
        $('#modif').click(function(event) {
        	
        	event.preventDefault();
        	//pour recuperer la date 
            var date= $('#date')[0].valueAsDate;
            ovni.year=date.getFullYear();
            ovni.month=date.getMonth()+1;
            ovni.day=date.getDate();
            //pour recuperer l'heure
            var time =  $( "#time")[0].valueAsDate;
            ovni.hour=time.getUTCHours();
            ovni.minute=time.getUTCMinutes();

        	
        	ovni.second=$('#duration').val();
  			ovni.city=$( "#area").val();
  			ovni.shape=$( "#shape").val();
			ovni.comments=$( "#comments").val();
			//console.log(ovni);

			updateSighting(ovni);
			effacerForm();
        })

       $('#recherche').submit(function(event){
       	event.preventDefault();
       	console.log($('#search').val());
      	console.log($( "#objetliste" ).val());

       });

       $('#data').submit(function(event){
			event.preventDefault();
       	 	effacerForm();



       });



	
getAllSightings(ajouterLesPoints, function() {mymap.addLayer(markers);});



	
});

function effacerForm(){
			$( "#date").val("");
  			$( "#time").val("");
			$( "#area").val("");
			$( "#shape").val("");
			$( "#duration").val("");
			$( "#comments").val("");
}
 


function ajoutpoint(e) 
{
	//pensée a le mettre dans la base de données 
	
	var lat=e.latlng.lat;
	var lng=e.latlng.lng;
	var id=0;
	var idsup=0;
	var point = {latitude:lat,longitude:lng};

   addSighting(point,function(id){ 
   idsup=id;
   mar.bindPopup("<button onClick=\"getSighting("+id+",afficher)\">  Modifier   </button>  <button class='marker-delete-button'> supprimer </button>");
});

   mar=L.marker([lat,lng]).addTo(mymap).on('popupopen', function () {
    					var mark = this;
    					// c'est pour supprimer un point
    					
    					$(".marker-delete-button").click (function () {
    	
    					deleteSighting(idsup,function(){

    						markers.removeLayer(mark);
        					mymap.removeLayer(mark);
        					effacerForm();
        				
    });
    					  });

    	});
   	

markers.addLayer(mar);
   
}






function afficher(data){
	 ovni= data;

var date = new Date(ovni.year,ovni.month,ovni.day)
var time = new Date(0);
time.setUTCHours(ovni.hour);
time.setUTCMinutes(ovni.minute)

  //recuperer les données du point grâce a la base de données
  //console.log(date);
  $( "#date")[0].valueAsDate=date;
  $( "#time")[0].valueAsDate=time;
  $( "#area").val(ovni.city);
  $( "#shape").val(ovni.shape);
  $( "#duration").val(ovni.second);
  $( "#comments").val(ovni.comments);
}



function ajouterLesPoints(point){
	var lat=point.latitude;
	var lng=point.longitude;
	var id =point.id;

	mar=L.marker([lat,lng]).on('popupopen', function () {
				var mark = this;
				// c'est pour supprimer un point
				$(".marker-delete-button").click (function () {
					deleteSighting(id,function(){

					markers.removeLayer(mark);
					mymap.removeLayer(mark);
					effacerForm();
				});
					});
	});

	mar.bindPopup("<button onClick=\"getSighting("+id+",afficher)\">  Modifier  </button>  <button class='marker-delete-button'> supprimer </button>");

	markers.addLayer(mar);
}




</script>


</body>
</html>
